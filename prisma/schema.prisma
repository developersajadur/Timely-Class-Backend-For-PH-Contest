generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // For Prisma <5.10 uncomment this:
  // directUrl = env("DATABASE_URL_UNPOOLED")
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(user)
  emailVerified Boolean  @default(false)
  isDeleted Boolean  @default(false)
  isBlocked Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  schedules Schedule[]
  Archive   Archive[]

  @@map("users")
}

model Schedule {
  id               String    @id @default(uuid())
  title            String?
  subject          String
  instructor       String
  day              String // e.g., "Monday"
  startTime        String // e.g., "09:00 AM"
  endTime          String // e.g., "10:30 AM"
  date             DateTime?
  color            String? // hex code
  description      String?
  priority         Int       @unique
  reminderMinutes  Int?
  lastReminderSent DateTime?
  reminderSent     Boolean   @default(false)
  isDeleted        Boolean   @default(false)
  userId           String
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  // Relations
  user     User      @relation(fields: [userId], references: [id])
  archives Archive[]

  @@map("schedules")
}

model Archive {
  id         String   @id @default(uuid())
  schedule   Schedule @relation(fields: [scheduleId], references: [id])
  scheduleId String
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  isDeleted  Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("archives")
}

model EmailOtp {
  id         String    @id @default(uuid())
  email      String
  otpHash    String
  expiresAt  DateTime
  verified   Boolean   @default(false)
  verifiedAt DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@index([email])
}

enum Role {
  user
  admin
}
